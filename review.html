<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Review Queue ‚Äî Sam's Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="review-data.js"></script>
<style>
  :root { --bg: #0a0a0a; --card: #141414; --border: #2a2a2a; --text: #e0e0e0; --muted: #888; --accent: #89CCF0; --green: #4ade80; --red: #f87171; --yellow: #fbbf24; }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
  .header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
  .header h1 { font-size: 18px; font-weight: 600; color: var(--accent); }
  .header .meta { font-size: 13px; color: var(--muted); }
  .container { max-width: 800px; margin: 0 auto; padding: 24px; }
  .status-bar { display: flex; align-items: center; gap: 12px; padding: 16px 20px; background: var(--card); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 24px; }
  .status-dot { width: 10px; height: 10px; border-radius: 50%; }
  .status-dot.pending { background: var(--yellow); }
  .status-dot.approved { background: var(--green); }
  .status-dot.rejected { background: var(--red); }
  .status-label { font-size: 14px; font-weight: 500; }
  .status-label.pending { color: var(--yellow); }
  .status-label.approved { color: var(--green); }
  .status-label.rejected { color: var(--red); }
  .urgency { margin-left: auto; font-size: 12px; padding: 4px 10px; border-radius: 6px; font-weight: 600; }
  .urgency.high { background: rgba(248,113,113,0.15); color: var(--red); }
  .urgency.medium { background: rgba(251,191,36,0.15); color: var(--yellow); }
  .urgency.low { background: rgba(74,222,128,0.15); color: var(--green); }
  .doc-content { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 32px; margin-bottom: 24px; line-height: 1.7; }
  .doc-content h1 { font-size: 22px; margin-bottom: 16px; color: #fff; }
  .doc-content h2 { font-size: 18px; margin: 24px 0 12px; color: var(--accent); }
  .doc-content p { margin-bottom: 12px; }
  .doc-content strong { color: #fff; }
  .doc-content em { color: var(--muted); }
  .doc-content hr { border: none; border-top: 1px solid var(--border); margin: 24px 0; }
  .doc-content ul, .doc-content ol { padding-left: 24px; margin-bottom: 12px; }
  .doc-content li { margin-bottom: 6px; }
  .actions { display: flex; gap: 12px; margin-bottom: 24px; }
  .btn { padding: 14px 28px; border: none; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; flex: 1; }
  .btn:hover { transform: translateY(-1px); }
  .btn.approve { background: var(--green); color: #000; }
  .btn.approve:hover { background: #22c55e; }
  .btn.reject { background: var(--red); color: #000; }
  .btn.reject:hover { background: #ef4444; }
  .btn.edit { background: var(--border); color: var(--text); }
  .btn.edit:hover { background: #333; }
  .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
  .notes-section { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 24px; }
  .notes-section label { font-size: 13px; color: var(--muted); display: block; margin-bottom: 8px; }
  .notes-section textarea { width: 100%; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text); padding: 12px; font-size: 14px; font-family: inherit; resize: vertical; min-height: 80px; }
  .notes-section textarea:focus { outline: none; border-color: var(--accent); }
  .result-banner { padding: 20px; border-radius: 12px; text-align: center; font-size: 16px; font-weight: 600; display: none; margin-bottom: 24px; }
  .result-banner.show { display: block; }
  .result-banner.approved { background: rgba(74,222,128,0.15); color: var(--green); border: 1px solid rgba(74,222,128,0.3); }
  .result-banner.rejected { background: rgba(248,113,113,0.15); color: var(--red); border: 1px solid rgba(248,113,113,0.3); }
  .queue-list { margin-top: 32px; }
  .queue-item { display: flex; align-items: center; gap: 12px; padding: 16px 20px; background: var(--card); border: 1px solid var(--border); border-radius: 10px; margin-bottom: 8px; text-decoration: none; color: var(--text); transition: border-color 0.2s; }
  .queue-item:hover { border-color: var(--accent); }
  .queue-item .title { flex: 1; font-weight: 500; }
  .queue-item .date { font-size: 12px; color: var(--muted); }
  .empty { text-align: center; padding: 60px 20px; color: var(--muted); }
  @media (max-width: 600px) { .container { padding: 16px; } .doc-content { padding: 20px; } .actions { flex-direction: column; } }
</style>
</head>
<body>
<div class="header">
  <h1>üìã Review Queue</h1>
  <div class="meta" id="headerMeta"></div>
</div>
<div class="container">
  <div id="statusBar" class="status-bar" style="display:none;">
    <div class="status-dot" id="statusDot"></div>
    <span class="status-label" id="statusLabel"></span>
    <span class="urgency" id="urgencyBadge"></span>
  </div>
  <div id="resultBanner" class="result-banner"></div>
  <div id="docContent" class="doc-content" style="display:none;"></div>
  <div id="notesSection" class="notes-section" style="display:none;">
    <label>Notes (optional ‚Äî I'll see these)</label>
    <textarea id="reviewNotes" placeholder="Any feedback, edits, or comments..."></textarea>
  </div>
  <div id="actionsBar" class="actions" style="display:none;">
    <button class="btn approve" onclick="submitReview('approved')">‚úì Approve</button>
    <button class="btn edit" onclick="submitReview('needs-edits')">‚úèÔ∏è Needs Edits</button>
    <button class="btn reject" onclick="submitReview('rejected')">‚úó Reject</button>
  </div>
  <div id="queueList" class="queue-list"></div>
</div>

<script>
const REVIEWS_KEY = 'openclaw-reviews';
const QUEUE_KEY = 'openclaw-review-queue';

function getQueue() {
  try { return JSON.parse(localStorage.getItem(QUEUE_KEY) || '[]'); } catch { return []; }
}
function getReviews() {
  try { return JSON.parse(localStorage.getItem(REVIEWS_KEY) || '{}'); } catch { return {}; }
}
function saveReview(id, data) {
  const reviews = getReviews();
  reviews[id] = { ...data, timestamp: new Date().toISOString() };
  localStorage.setItem(REVIEWS_KEY, JSON.stringify(reviews));
}

function loadDoc(id) {
  const queue = getQueue();
  const item = queue.find(q => q.id === id);
  if (!item) { document.getElementById('docContent').innerHTML = '<p>Document not found.</p>'; document.getElementById('docContent').style.display = 'block'; return; }

  const reviews = getReviews();
  const existing = reviews[id];

  document.getElementById('headerMeta').textContent = item.date || '';
  document.getElementById('statusBar').style.display = 'flex';

  const status = existing ? existing.status : 'pending';
  document.getElementById('statusDot').className = 'status-dot ' + (status === 'needs-edits' ? 'pending' : status);
  document.getElementById('statusLabel').className = 'status-label ' + (status === 'needs-edits' ? 'pending' : status);
  document.getElementById('statusLabel').textContent = status === 'needs-edits' ? '‚úèÔ∏è Needs Edits' : status === 'approved' ? '‚úì Approved' : status === 'rejected' ? '‚úó Rejected' : '‚è≥ Pending Review';

  if (item.urgency) {
    const badge = document.getElementById('urgencyBadge');
    badge.style.display = '';
    badge.className = 'urgency ' + item.urgency;
    badge.textContent = item.urgency.toUpperCase() + ' priority';
  }

  document.getElementById('docContent').innerHTML = marked.parse(item.content);
  document.getElementById('docContent').style.display = 'block';
  document.getElementById('notesSection').style.display = 'block';
  document.getElementById('actionsBar').style.display = existing ? 'none' : 'flex';

  if (existing) {
    const banner = document.getElementById('resultBanner');
    banner.className = 'result-banner show ' + (existing.status === 'needs-edits' ? 'rejected' : existing.status);
    banner.textContent = existing.status === 'approved' ? '‚úì You approved this on ' + new Date(existing.timestamp).toLocaleDateString() :
                         existing.status === 'rejected' ? '‚úó You rejected this on ' + new Date(existing.timestamp).toLocaleDateString() :
                         '‚úèÔ∏è You marked this as needing edits on ' + new Date(existing.timestamp).toLocaleDateString();
    if (existing.notes) document.getElementById('reviewNotes').value = existing.notes;
    document.getElementById('reviewNotes').disabled = true;
  }
}

function submitReview(status) {
  const params = new URLSearchParams(window.location.search);
  const id = params.get('id');
  if (!id) return;

  const notes = document.getElementById('reviewNotes').value;
  saveReview(id, { status, notes });

  const banner = document.getElementById('resultBanner');
  banner.className = 'result-banner show ' + (status === 'needs-edits' ? 'rejected' : status);
  banner.textContent = status === 'approved' ? '‚úì Approved ‚Äî I\'ll proceed!' :
                       status === 'rejected' ? '‚úó Rejected ‚Äî noted.' :
                       '‚úèÔ∏è Needs Edits ‚Äî add your notes below and I\'ll revise.';

  document.getElementById('actionsBar').style.display = 'none';
  document.getElementById('statusDot').className = 'status-dot ' + (status === 'needs-edits' ? 'pending' : status);
  document.getElementById('statusLabel').className = 'status-label ' + (status === 'needs-edits' ? 'pending' : status);
  document.getElementById('statusLabel').textContent = status === 'approved' ? '‚úì Approved' : status === 'rejected' ? '‚úó Rejected' : '‚úèÔ∏è Needs Edits';

  // Pulse the banner
  banner.style.animation = 'none'; banner.offsetHeight; banner.style.animation = '';
}

function showQueue() {
  const queue = getQueue();
  const reviews = getReviews();
  const list = document.getElementById('queueList');

  if (queue.length === 0) {
    list.innerHTML = '<div class="empty">No items in review queue</div>';
    return;
  }

  list.innerHTML = '<h2 style="color:var(--accent);margin-bottom:16px;font-size:16px;">All Review Items</h2>';
  queue.forEach(item => {
    const status = reviews[item.id] ? reviews[item.id].status : 'pending';
    const dot = status === 'approved' ? 'üü¢' : status === 'rejected' ? 'üî¥' : status === 'needs-edits' ? 'üü°' : '‚è≥';
    list.innerHTML += `<a href="?id=${item.id}" class="queue-item"><span>${dot}</span><span class="title">${item.title}</span><span class="date">${item.date || ''}</span></a>`;
  });
}

// Init
const params = new URLSearchParams(window.location.search);
const docId = params.get('id');

if (docId) {
  loadDoc(docId);
} else {
  showQueue();
}
</script>
</body>
</html>
